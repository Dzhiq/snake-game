<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>é«˜çº§è´ªåƒè›‡</title>

<style>
body{
    margin:0;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    font-family:Arial, sans-serif;
    color:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.game-box{
    text-align:center;
}

canvas{
    background:#000;
    border-radius:12px;
    box-shadow:0 0 20px rgba(0,0,0,0.6);
}

h1{margin:8px 0;}

.info{
    margin:6px 0;
}

button{
    padding:10px 20px;
    border:none;
    border-radius:8px;
    background:#4CAF50;
    color:#fff;
    font-size:16px;
    cursor:pointer;
}
button:hover{background:#45a049;}

.overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.7);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
}
.hidden{display:none;}

/* æ–°å¢ä½œè€…ä¿¡æ¯æ ·å¼ */
.author {
    margin-top: 10px;
    font-size: 14px;
    color: #cccccc; /* æµ…ç°è‰²ï¼Œä¸èƒŒæ™¯å¯¹æ¯”ä¸”ä¸å–§å®¾å¤ºä¸» */
}

</style>
</head>

<body>

<div class="game-box">
    <h1>ğŸ è´ªåƒè›‡</h1>
    <div class="info">å¾—åˆ†ï¼š<span id="score">0</span> | æœ€é«˜åˆ†ï¼š<span id="best">0</span></div>
    <canvas id="game" width="320" height="320"></canvas>
    <br/>
    <!-- æ–°å¢ä½œè€…ä¿¡æ¯æ˜¾ç¤º -->
    <p class="author">Authorï¼šdzq</p>
    <button onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
</div>

<div id="gameOver" class="overlay hidden">
    <h2>æ¸¸æˆç»“æŸ</h2>
    <p id="finalScore"></p>
    <button onclick="startGame()">é‡æ–°å¼€å§‹</button>
</div>

<audio id="eatSound" src="https://cdn.jsdelivr.net/gh/naptha/tiny-sound@master/eat.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const grid = 16;

let snake, food, dx, dy, score, timer;

const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");
const overBox = document.getElementById("gameOver");
const finalScore = document.getElementById("finalScore");
const eatSound = document.getElementById("eatSound");

/* æœ€é«˜åˆ† */
let best = localStorage.getItem("snake_best") || 0;
bestEl.textContent = best;

/* åˆå§‹åŒ– */
function init(){
    snake=[{x:10,y:10}];
    dx=1; dy=0;
    score=0;
    scoreEl.textContent=0;
    randomFood();
}

/* éšæœºé£Ÿç‰© */
function randomFood(){
    food={
        x:Math.floor(Math.random()*20),
        y:Math.floor(Math.random()*20)
    };
}

/* ç»˜åˆ¶ */
function draw(){
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    /* é£Ÿç‰© */
    ctx.fillStyle="#ff5252";
    ctx.fillRect(food.x*grid,food.y*grid,grid-2,grid-2);

    /* è›‡ */
    ctx.fillStyle="#4CAF50";
    snake.forEach((p,i)=>{
        ctx.globalAlpha = 1 - i*0.03;
        ctx.fillRect(p.x*grid,p.y*grid,grid-2,grid-2);
    });
    ctx.globalAlpha = 1;
}

/* æ›´æ–° */
function update(){
    const head={x:snake[0].x+dx,y:snake[0].y+dy};

    /* æ’å¢™æˆ–æ’è‡ªå·± */
    if(
        head.x<0||head.y<0||
        head.x>=20||head.y>=20||
        snake.some(p=>p.x===head.x&&p.y===head.y)
    ){
        gameOver();
        return;
    }

    snake.unshift(head);

    /* åƒé£Ÿç‰© */
    if(head.x===food.x&&head.y===food.y){
        score++;
        scoreEl.textContent=score;
        eatSound.currentTime=0;
        eatSound.play();
        randomFood();
    }else{
        snake.pop();
    }
}

/* å¾ªç¯ */
function loop(){
    update();
    draw();
}

/* å¼€å§‹ */
function startGame(){
    overBox.classList.add("hidden");
    init();
    clearInterval(timer);
    timer=setInterval(loop,120);
}

/* ç»“æŸ */
function gameOver(){
    clearInterval(timer);
    finalScore.textContent="æœ¬æ¬¡å¾—åˆ†ï¼š"+score;

    if(score>best){
        best=score;
        localStorage.setItem("snake_best",best);
        bestEl.textContent=best;
    }

    overBox.classList.remove("hidden");
}

/* é”®ç›˜æ§åˆ¶ */
document.addEventListener("keydown",e=>{
    if(e.key==="ArrowUp"&&dy===0){dx=0;dy=-1;}
    if(e.key==="ArrowDown"&&dy===0){dx=0;dy=1;}
    if(e.key==="ArrowLeft"&&dx===0){dx=-1;dy=0;}
    if(e.key==="ArrowRight"&&dx===0){dx=1;dy=0;}
});

/* æ‰‹æœºæ»‘åŠ¨æ§åˆ¶ */
let sx,sy;
canvas.addEventListener("touchstart",e=>{
    sx=e.touches[0].clientX;
    sy=e.touches[0].clientY;
});
canvas.addEventListener("touchend",e=>{
    const dxm=e.changedTouches[0].clientX-sx;
    const dym=e.changedTouches[0].clientY-sy;

    if(Math.abs(dxm)>Math.abs(dym)){
        if(dxm>0&&dx===0){dx=1;dy=0;}
        else if(dxm<0&&dx===0){dx=-1;dy=0;}
    }else{
        if(dym>0&&dy===0){dx=0;dy=1;}
        else if(dym<0&&dy===0){dx=0;dy=-1;}
    }
});
</script>
</body>
</html>
