<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>é«˜çº§è´ªåƒè›‡</title>

<style>
body{
    margin:0;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    font-family:Arial, sans-serif;
    color:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow: hidden; /* é˜²æ­¢é¡µé¢å‡ºç°æ»šåŠ¨æ¡ */
}

.game-box{
    text-align:center;
    position: relative;
}

canvas{
    background:#000;
    border-radius:12px;
    box-shadow:0 0 20px rgba(0,0,0,0.6);
    display: block;
    margin: 0 auto;
    touch-action: none; /* é˜»æ­¢æµè§ˆå™¨é»˜è®¤çš„åŒæŒ‡ç¼©æ”¾ç­‰æ‰‹åŠ¿ */
}

h1{margin:8px 0;}

.info{
    margin:6px 0;
}

button{
    padding:10px 20px;
    border:none;
    border-radius:8px;
    background:#4CAF50;
    color:#fff;
    font-size:16px;
    cursor:pointer;
    margin: 5px;
}
button:hover{background:#45a049;}

.overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.7);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    z-index: 10;
}

.hidden{display:none;}

/* æ–°å¢ä½œè€…ä¿¡æ¯æ ·å¼ */
.author {
    margin-top: 10px;
    font-size: 14px;
    color: #cccccc;
}

/* éš¾åº¦é€‰æ‹©å®¹å™¨æ ·å¼ */
.difficulty-container {
    margin: 10px 0;
}

.difficulty-btn {
    padding: 8px 16px;
    font-size: 14px;
    background-color: #6c757d;
}

.difficulty-btn.active {
    background-color: #007bff;
}

</style>
</head>

<body>

<div class="game-box">
    <h1>ğŸ è´ªåƒè›‡</h1>
    <div class="info">å¾—åˆ†ï¼š<span id="score">0</span> | æœ€é«˜åˆ†ï¼š<span id="best">0</span></div>
    
    <!-- éš¾åº¦é€‰æ‹©æŒ‰é’® -->
    <div class="difficulty-container">
        <button id="easyBtn" class="difficulty-btn active" onclick="setDifficulty('easy')">ç®€å•</button>
        <button id="normalBtn" class="difficulty-btn" onclick="setDifficulty('normal')">ä¸€èˆ¬</button>
        <button id="hardBtn" class="difficulty-btn" onclick="setDifficulty('hard')">å›°éš¾</button>
    </div>

    <canvas id="game" width="320" height="320"></canvas>
    
    <br/>
    <!-- æ–°å¢ä½œè€…ä¿¡æ¯æ˜¾ç¤º -->
    <p class="author">Authorï¼šdzq</p>
    <button id="startButton" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
</div>

<div id="gameOver" class="overlay hidden">
    <h2>æ¸¸æˆç»“æŸ</h2>
    <p id="finalScore"></p>
    <button onclick="restartGame()">å†æ¥ä¸€æ¬¡</button>
    <button onclick="backToMenu()">è¿”å›èœå•</button>
</div>

<audio id="eatSound" src="https://cdn.jsdelivr.net/gh/naptha/tiny-sound@master/eat.mp3"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const grid = 16;

let snake, food, dx, dy, score, timer;

// éš¾åº¦ç›¸å…³å˜é‡
let currentDifficulty = 'normal';
const difficultySettings = {
    easy: { speed: 180 },
    normal: { speed: 120 },
    hard: { speed: 70 }
};

// éš¾åº¦æŒ‰é’®å…ƒç´ 
const easyBtn = document.getElementById('easyBtn');
const normalBtn = document.getElementById('normalBtn');
const hardBtn = document.getElementById('hardBtn');
const startButton = document.getElementById('startButton');

const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");
const overBox = document.getElementById("gameOver");
const finalScore = document.getElementById("finalScore");
const eatSound = document.getElementById("eatSound");

// --- æ»‘åŠ¨æ§åˆ¶ç›¸å…³å˜é‡ ---
let touchStartX = 0;
let touchStartY = 0;
const minSwipeDistance = 15; // è®¾ç½®æœ€å°æ»‘åŠ¨è·ç¦»é˜ˆå€¼ï¼Œå•ä½åƒç´ 

/* æœ€é«˜åˆ† */
let best = localStorage.getItem("snake_best") || 0;
bestEl.textContent = best;

/* åˆå§‹åŒ– */
function init(){
    snake=[{x:10,y:10}];
    dx=1; dy=0;
    score=0;
    scoreEl.textContent=0;
    randomFood();
}

/* éšæœºé£Ÿç‰© */
function randomFood(){
    food={
        x:Math.floor(Math.random()*20),
        y:Math.floor(Math.random()*20)
    };
}

/* ç»˜åˆ¶ */
function draw(){
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    /* é£Ÿç‰© */
    ctx.fillStyle="#ff5252";
    ctx.fillRect(food.x*grid,food.y*grid,grid-2,grid-2);

    /* è›‡ */
    ctx.fillStyle="#4CAF50";
    snake.forEach((p,i)=>{
        ctx.globalAlpha = 1 - i*0.03;
        ctx.fillRect(p.x*grid,p.y*grid,grid-2,grid-2);
    });
    ctx.globalAlpha = 1;
}

/* æ›´æ–° */
function update(){
    const head={x:snake[0].x+dx,y:snake[0].y+dy};

    /* æ’å¢™æˆ–æ’è‡ªå·± */
    if(
        head.x<0||head.y<0||
        head.x>=20||head.y>=20||
        snake.some(p=>p.x===head.x&&p.y===head.y)
    ){
        gameOver();
        return;
    }

    snake.unshift(head);

    /* åƒé£Ÿç‰© */
    if(head.x===food.x&&head.y===food.y){
        score++;
        scoreEl.textContent=score;
        eatSound.currentTime=0;
        eatSound.play();
        randomFood();
    }else{
        snake.pop();
    }
}

/* å¾ªç¯ */
function loop(){
    update();
    draw();
}

/* è®¾ç½®éš¾åº¦ */
function setDifficulty(level) {
    currentDifficulty = level;
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    easyBtn.classList.toggle('active', level === 'easy');
    normalBtn.classList.toggle('active', level === 'normal');
    hardBtn.classList.toggle('active', level === 'hard');
}

/* å¼€å§‹æ¸¸æˆ */
function startGame(){
    if (!currentDifficulty) {
        setDifficulty('normal');
    }
    init();
    clearInterval(timer);
    timer = setInterval(loop, difficultySettings[currentDifficulty].speed);
    overBox.classList.add("hidden");
}

/* é‡æ–°å¼€å§‹æ¸¸æˆ */
function restartGame(){
    init();
    clearInterval(timer);
    timer = setInterval(loop, difficultySettings[currentDifficulty].speed);
    overBox.classList.add("hidden");
}

/* è¿”å›ä¸»èœå• */
function backToMenu(){
    clearInterval(timer);
    overBox.classList.add("hidden");
    init();
    score = 0;
    scoreEl.textContent = score;
}

/* ç»“æŸ */
function gameOver(){
    clearInterval(timer);
    finalScore.textContent="æœ¬æ¬¡å¾—åˆ†ï¼š"+score;

    if(score>best){
        best=score;
        localStorage.setItem("snake_best",best);
        bestEl.textContent=best;
    }

    overBox.classList.remove("hidden");
}

/* é”®ç›˜æ§åˆ¶ */
document.addEventListener("keydown",e=>{
    if(e.key==="ArrowUp"&&dy===0){dx=0;dy=-1;}
    if(e.key==="ArrowDown"&&dy===0){dx=0;dy=1;}
    if(e.key==="ArrowLeft"&&dx===0){dx=-1;dy=0;}
    if(e.key==="ArrowRight"&&dx===0){dx=1;dy=0;}
});

// --- æ”¹è¿›çš„æ»‘åŠ¨æ§åˆ¶ ---
canvas.addEventListener("touchstart", e => {
    // é˜²æ­¢é•¿æŒ‰è§¦å‘ç³»ç»Ÿèœå•
    e.preventDefault();
    const touch = e.touches[0];
    touchStartX = touch.clientX;
    touchStartY = touch.clientY;
}, { passive: false });

canvas.addEventListener("touchend", e => {
    const touch = e.changedTouches[0];
    const distX = touch.clientX - touchStartX;
    const distY = touch.clientY - touchStartY;

    // æ£€æŸ¥æ»‘åŠ¨è·ç¦»æ˜¯å¦è¶³å¤Ÿ
    if (Math.abs(distX) < minSwipeDistance && Math.abs(distY) < minSwipeDistance) {
        return; // æ»‘åŠ¨å¤ªçŸ­ï¼Œå¿½ç•¥
    }

    // åˆ¤æ–­æ˜¯æ°´å¹³æ»‘åŠ¨è¿˜æ˜¯å‚ç›´æ»‘åŠ¨
    if (Math.abs(distX) > Math.abs(distY)) {
        // æ°´å¹³æ»‘åŠ¨
        if (distX > 0 && dx === 0) {
            // å‘å³æ»‘åŠ¨ï¼Œä¸”å½“å‰ä¸æ˜¯å‘å·¦ç§»åŠ¨
            dx = 1; dy = 0;
        } else if (distX < 0 && dx === 0) {
            // å‘å·¦æ»‘åŠ¨ï¼Œä¸”å½“å‰ä¸æ˜¯å‘å³ç§»åŠ¨
            dx = -1; dy = 0;
        }
    } else {
        // å‚ç›´æ»‘åŠ¨
        if (distY > 0 && dy === 0) {
            // å‘ä¸‹æ»‘åŠ¨ï¼Œä¸”å½“å‰ä¸æ˜¯å‘ä¸Šç§»åŠ¨
            dx = 0; dy = 1;
        } else if (distY < 0 && dy === 0) {
            // å‘ä¸Šæ»‘åŠ¨ï¼Œä¸”å½“å‰ä¸æ˜¯å‘ä¸‹ç§»åŠ¨
            dx = 0; dy = -1;
        }
    }
    // æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰ preventDefaultï¼Œå› ä¸ºæˆ‘ä»¬åªå…³å¿ƒ touchend äº‹ä»¶
    // é˜²æ­¢é»˜è®¤è¡Œä¸ºå·²åœ¨ touchstart ä¸­å¤„ç†
});

</script>
</body>
</html>
